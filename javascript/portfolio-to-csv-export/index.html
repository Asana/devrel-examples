<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="./style.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <form onsubmit="return false" id="mainform">
      <h2>Report: Status updates from all projects in a portfolio</h2>
      <details style="display: block">
        <summary><b>Instructions</b></summary>
        <p>
          This tool is used to generate a CSV of project records, including
          their custom fields, from a nested portfolio structure in Asana.
        </p>
        <p>
          To use this tool, you'll need a <b>personal access token</b> and a
          <b>link to the top-level portfolio</b> you'd like to export.
        </p>
        <p><b>Personal access token:</b></p>
        <p>
          For information on how generate your own personal access token,
          navigate to
          <a
            target="_blank"
            href="https://developers.asana.com/docs/personal-access-token"
            >https://developers.asana.com/docs/personal-access-token</a
          >
        </p>
        <p>
          <em>You should treat this token like a password!</em> It allows
          programmatic access to Asana as you, so it is best saved in a password
          manager or private vault. If you have any reason to think a token may
          have been compromised, you can reset it or delete it in the developer
          console. See documentation at:
          <a
            target="_blank"
            href="https://developers.asana.com/docs/developer-console"
            >https://developers.asana.com/docs/developer-console</a
          >
        </p>
        <p><b>Portfolio GID</b></p>
        <p>
          To obtain your portfolio GID, simply navigate to your portfolio in the
          Asana app, and copy the GID from the URL itself. For example, if the
          link is "https://app.asana.com/0/portfolio/12345/list", you should
          copy <em>12345</em>
        </p>
        <br />
        <p>
          Enter these details in the form below, and a CSV file will be
          generated to download. You may be prompted to approve or allow
          downloads from this page.
        </p>
        <p>
          Note that you'll only be able to export projects and portfolios that
          you have access to and can view in Asana.
        </p>
      </details>

      <div class="input-block">
        <label for="pat">Personal access token</label>
        <input
          id="pat"
          class="form-control form-rounded"
          autocomplete="current-password"
          name="Personal Access Token"
          type="password"
          required
        />
      </div>

      <div class="input-block">
        <label for="pat">Portfolio GID</label>
        <input
          id="portfolio"
          type="text"
          class="form-control form-rounded"
          required
        />
      </div>

      <div class="input-block">
        <input
          id="submit"
          type="button"
          class="btn btn-primary"
          value="Generate CSV"
          onclick="runExport()"
        />
      </div>

      <div id="errorbox"></div>
    </form>
  </body>
  <script src="./index.js"></script>
  <script src="./utils.js"></script>
</html>
